<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Contact — Pullman Abidjan</title>
<meta name="theme-color" content="#0b6b48">

<!-- iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://script.google.com" crossorigin>
<link rel="preconnect" href="https://script.googleusercontent.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- ================= EARLY DATA LOAD ================= -->
<script>
(function(){
  function qs(k){return new URL(location.href).searchParams.get(k)||''}
  const id=(qs('id')||'').trim();
  if(!id){
    document.documentElement.innerHTML='<body style="padding:24px;color:#fff;background:#000">Paramètre id manquant</body>';
    return;
  }

  const DEPLOY_ID='AKfycbx6gzLF2I63qsrjP-NzAZSvJFpHk03HQEbHtM2mfe4cHovumTGAfSnwsTKGLw1Lt0stSA';
  const API=`https://script.google.com/macros/s/${DEPLOY_ID}/exec?mode=jsonp&id=${encodeURIComponent(id)}&callback=onDataEarly`;
  const CACHE_KEY=`contact_cache_${id}`;
  const CACHE_TTL=12*60*60*1000;

  window.onDataEarly=function(data){
    try{
      if(data && !data.error){
        window.__contactData=data;
        localStorage.setItem(CACHE_KEY,JSON.stringify({ts:Date.now(),data}));
        if(typeof window.__renderContact==='function'){
          window.__renderContact(data);
        }
      }
    }catch(e){}
  };

  const js=document.createElement('script');
  js.src=API;
  document.head.appendChild(js);

  window.__contactConfig={id,CACHE_KEY,CACHE_TTL};
})();
</script>

<style>
:root{
  --bg-img:url('assets/bg.jpg');
  --contact-bg:url('assets/fond-contact.jpg');
  --heritage:#0b6b48;
  --vibrant:#00c070;
  --overlay:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.78));
  --radius-xl:22px;
  --radius-md:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Noto Sans',system-ui,sans-serif;
  background:var(--overlay),var(--bg-img);
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
  color:#f9fafb;
}
.wrap{
  max-width:620px;
  margin:auto;
  padding:20px;
}
.hero{text-align:center;margin-bottom:28px}
.hero h1{font-size:22px;font-weight:700}
.hero p{font-size:15px;color:#d1d5db;margin-top:4px}

/* CARDS */
.card{
  position:relative;
  border-radius:var(--radius-xl);
  overflow:hidden;
  margin-bottom:18px;
  padding:24px 22px;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 12px 30px rgba(0,0,0,.35);
}
.card.contact{background:var(--contact-bg) center/cover no-repeat}
.card.site{background:var(--bg-img) center/cover no-repeat}
.card::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.75));
}
.card > *{position:relative;z-index:1}

/* TEXT */
h2{text-align:center;font-size:19px;font-weight:700;margin-bottom:6px}
.muted{text-align:center;font-size:14px;color:#e5e7eb;margin-bottom:16px}

/* ROWS */
.row{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-radius:var(--radius-md);
}
.row:active{background:rgba(255,255,255,.08)}
.val a{color:#fff;text-decoration:none;font-size:15px}
.copy{
  margin-left:auto;
  padding:6px 10px;
  border-radius:10px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.25);
  color:#fff;
  font-size:12px;
}

/* BUTTON */
.btn{
  display:inline-flex;
  justify-content:center;
  padding:16px 28px;
  border-radius:40px;
  font-weight:700;
  background:var(--vibrant);
  color:#0a0a0a;
  text-decoration:none;
  width:min(420px,92%);
}
.btn-wrap{text-align:center;margin-top:18px}

/* SKELETON */
.skel .bar{
  height:12px;
  border-radius:8px;
  background:rgba(255,255,255,.25);
  animation:pulse 1.2s infinite ease-in-out;
}
@keyframes pulse{0%{opacity:.5}50%{opacity:1}100%{opacity:.5}}
</style>
</head>

<body>
<div class="wrap">

<section class="hero">
  <h1>Bienvenue à l’Hôtel Pullman Abidjan</h1>
  <p>Scannez pour enregistrer le contact ou visiter notre site.</p>
</section>

<section class="card contact">
  <h2 id="fn">Contact</h2>
  <p id="subtitle" class="muted"></p>

  <!-- Skeleton immédiat -->
  <div id="skel" class="skel">
    <div class="row"><div class="bar" style="width:60%"></div></div>
    <div class="row"><div class="bar" style="width:40%"></div></div>
    <div class="row"><div class="bar" style="width:70%"></div></div>
  </div>

  <div id="row-tel" class="row" style="display:none">
    <div class="val"><a id="telLink"></a></div>
    <button class="copy">Copier</button>
  </div>

  <div id="row-wa" class="row" style="display:none">
    <div class="val"><a id="waLink"></a></div>
  </div>

  <div id="row-mail" class="row" style="display:none">
    <div class="val"><a id="mailLink"></a></div>
    <button class="copy">Copier</button>
  </div>

  <div class="btn-wrap">
    <a id="btnVcf" class="btn" href="#">Enregistrer le contact</a>
  </div>
</section>

<section class="card site">
  <div class="btn-wrap">
    <a id="btnSiteHero" class="btn" href="#" target="_blank">Visiter le site</a>
  </div>
</section>

</div>

<!-- ================= RENDER + CACHE ================= -->
<script>
(function(){
  const telLink=document.getElementById('telLink');
  const mailLink=document.getElementById('mailLink');
  const waLink=document.getElementById('waLink');
  const rowTel=document.getElementById('row-tel');
  const rowWa=document.getElementById('row-wa');
  const rowMail=document.getElementById('row-mail');
  const btnSiteHero=document.getElementById('btnSiteHero');
  const btnVcf=document.getElementById('btnVcf');
  const skel=document.getElementById('skel');

  window.__renderContact=function(d){
    if(skel) skel.style.display='none';

    const fn=[d.prenom||'',d.nom||''].join(' ').trim()||'Contact';
    document.getElementById('fn').textContent=fn;
    document.getElementById('subtitle').textContent=d.poste||'';

    if(d.telephone){
      const tel=d.telephone.trim();
      telLink.textContent=tel;
      telLink.href=`tel:${tel}`;
      rowTel.style.display='';

      let waNum=tel.replace(/[^\d]/g,'');
      if(!waNum.startsWith('225')){
        waNum='225'+waNum; // conserve le 0
      }
      waLink.textContent='WhatsApp';
      waLink.href=`https://wa.me/${waNum}`;
      rowWa.style.display='';
    }

    if(d.email){
      mailLink.textContent=d.email;
      mailLink.href=`mailto:${d.email}`;
      rowMail.style.display='';
    }

    btnSiteHero.href=d.hotelSite||'#';

    btnVcf.onclick=()=>{
      const lines=['BEGIN:VCARD','VERSION:3.0',`FN:${fn}`];
      if(d.telephone)lines.push('TEL:'+d.telephone);
      if(d.email)lines.push('EMAIL:'+d.email);
      lines.push('END:VCARD');
      const blob=new Blob([lines.join('\r\n')],{type:'text/vcard'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='contact.vcf';
      a.click();
    };
  };

  /* ⚡ Rendu instantané depuis le cache */
  try{
    const id=new URL(location.href).searchParams.get('id');
    const raw=localStorage.getItem('contact_cache_'+id);
    if(raw){
      const c=JSON.parse(raw);
      if(c && c.data){
        window.__renderContact(c.data);
      }
    }
  }catch(e){}
})();
</script>

</body>
</html>
