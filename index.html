<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Contact — Pullman Abidjan</title>
<meta name="theme-color" content="#0b0b0c">
<style>
  :root{
    --bg-img:url('assets/bg.jpg');
    --overlay:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.8));
    --accent:#C5A572;
    --text:#f9fafb;
    --muted:#d1d5db;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0; background:var(--overlay),var(--bg-img);
    background-size:cover;background-position:center;background-attachment:fixed;
    color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  }
  .wrap{max-width:600px;margin:auto;padding:20px;}
  .hero{text-align:center;margin-bottom:24px;animation:fadeIn .9s ease-out both;}
  .hero h1{margin:0 0 4px;font-size:22px;font-weight:600}
  .hero p{margin:0;color:var(--muted);font-size:15px}
  .card{
    backdrop-filter:blur(8px);background:rgba(0,0,0,0.5);
    border-radius:16px;padding:18px;margin-bottom:16px;animation:fadeUp .9s ease-out both;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:none}}
  @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
  h2{text-align:center;font-size:18px;margin:0 0 10px}
  .muted{text-align:center;color:var(--muted);margin:0 0 16px;font-size:14px}
  .row{display:flex;align-items:center;gap:10px;margin:10px 0}
  .icon{width:20px;height:20px;color:var(--accent);flex-shrink:0}
  .val a{color:var(--text);font-size:15px;text-decoration:none}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:10px 16px;border-radius:8px;font-weight:600;font-size:14px;
    background:var(--accent);color:#1b1b1b;text-decoration:none;border:none;
    margin:14px auto 0;
  }
  .btn svg{width:18px;height:18px}
  .btn:active{opacity:.85}
  .btn-wrap{text-align:center}
  .site-title{text-align:center;font-weight:600;margin:0 0 8px;font-size:17px}
  .site-url{text-align:center;word-break:break-all;color:var(--muted);font-size:13px}

  /* === Prévisualisation du site === */
  .preview{display:flex;flex-direction:column;gap:10px}
  .frame-wrap{
    position:relative;border-radius:12px;overflow:hidden;background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    aspect-ratio: 16 / 10; /* ratio large */
  }
  @media (max-width:420px){ .frame-wrap{ aspect-ratio: 4 / 5; } } /* plus haut en mobile */
  .frame-skeleton{
    position:absolute;inset:0;background:
      linear-gradient(100deg, rgba(255,255,255,.06) 30%, rgba(255,255,255,.12) 50%, rgba(255,255,255,.06) 70%);
    background-size:200% 100%; animation:shimmer 1.4s infinite;
  }
  @keyframes shimmer{to{background-position:-200% 0}}
  .site-iframe{
    position:absolute;inset:0;width:100%;height:100%;border:0;opacity:0;transition:opacity .25s ease;
    background:transparent;
  }
  .frame-wrap.loaded .site-iframe{opacity:1}
  .fallback{
    position:relative;overflow:hidden;border-radius:12px;
    background: url('assets/bg.jpg') center/cover no-repeat;
    min-height:220px;border:1px solid rgba(255,255,255,.12);
  }
  .fallback::after{
    content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.55));
  }
  .fallback-content{
    position:absolute;inset:auto 12px 12px 12px;z-index:2;color:#fff;
  }
  .fallback-title{font-weight:700;margin:0 0 6px}
  .fallback-desc{margin:0 0 10px;color:#e5e7eb;font-size:14px}
</style>
</head>
<body>
<div class="wrap">

  <!-- Titre -->
  <section class="hero">
    <h1>Bienvenue à l’Hôtel Pullman Abidjan</h1>
    <p>Scannez pour enregistrer le contact ou visiter notre site.</p>
  </section>

  <!-- Carte Contact -->
  <section class="card">
    <h2 id="fn">Contact</h2>
    <p id="subtitle" class="muted"></p>

    <div id="row-tel" class="row" style="display:none">
      <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.7 19.7 0 0 1 3.1 5.18A2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.12.86.35 1.7.68 2.49a2 2 0 0 1-.45 2.11l-1.27 1.27a16 16 0 0 0 6.29 6.29l1.27-1.27a2 2 0 0 1 2.11-.45c.79.33 1.63.56 2.49.68A2 2 0 0 1 22 16.92z"/></svg>
      <div class="val"><a id="telLink"></a></div>
    </div>

    <div id="row-wa" class="row" style="display:none">
      <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19.05 4.91A9 9 0 0 0 4.91 19.05L3 21l1.95-1.91A9 9 0 1 0 19.05 4.91Zm-7.86 2.42c.21 0 .44.01.66.04a.62.62 0 0 1 .52.42c.14.38.45 1.33.49 1.44.08.21.05.37-.03.49-.08.12-.12.17-.24.28-.12.11-.21.24-.09.46.12.21.53.87 1.14 1.41.78.69 1.43.9 1.65 1.01.21.11.34.1.47-.06.13-.16.54-.63.68-.85.14-.22.28-.18.47-.11.19.08 1.21.57 1.42.67.21.11.35.16.4.25.06.09.06.52-.12 1.02-.18.5-1.02.98-1.43 1.05-.37.06-.83.09-1.34-.08-.31-.1-.71-.23-1.22-.46-2.14-.92-3.53-3.09-3.64-3.24-.11-.15-.87-1.17-1.1-2.2-.24-1.03.13-1.67.3-1.91.17-.24.37-.38.5-.43.13-.05.29-.04.37-.03Z"/></svg>
      <div class="val"><a id="waLink"></a></div>
    </div>

    <div id="row-mail" class="row" style="display:none">
      <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      <div class="val"><a id="mailLink"></a></div>
    </div>

    <div class="btn-wrap">
      <a id="btnVcf" class="btn" href="#">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Enregistrer le contact
      </a>
    </div>
  </section>

  <!-- Carte Prévisualisation du site -->
  <section class="card">
    <h2 class="site-title">Aperçu du site</h2>
    <div class="preview">
      <!-- IFRAME (si autorisé) -->
      <div id="frameWrap" class="frame-wrap">
        <div id="skeleton" class="frame-skeleton"></div>
        <iframe id="siteFrame" class="site-iframe" referrerpolicy="no-referrer" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
      </div>

      <!-- FALLBACK (si iframe bloquée) -->
      <div id="fallback" class="fallback" style="display:none">
        <div class="fallback-content">
          <h3 class="fallback-title">Pullman Abidjan — Site officiel</h3>
          <p class="fallback-desc">Explorez nos services, offres et informations de contact.</p>
          <div class="btn-wrap">
            <a id="btnSiteFallback" class="btn" href="#" target="_blank" rel="noopener">Ouvrir le site</a>
          </div>
        </div>
      </div>

      <!-- Lien textuel discret -->
      <p class="site-url"><a id="siteLink2" href="#" target="_blank" rel="noopener"></a></p>
    </div>
  </section>

</div>

<script>
(function(){
  function qs(k){return new URL(location.href).searchParams.get(k)||''}
  const id=qs('id').trim();
  if(!id){document.body.innerHTML='<div style="padding:24px">Paramètre id manquant</div>';return;}
  const DEPLOY_ID='AKfycbx6gzLF2I63qsrjP-NzAZSvJFpHk03HQEbHtM2mfe4cHovumTGAfSnwsTKGLw1Lt0stSA';
  const API=`https://script.google.com/macros/s/${DEPLOY_ID}/exec?mode=jsonp&id=${encodeURIComponent(id)}&callback=onData`;

  window.onData=function(data){
    if(data.error){document.body.innerHTML='<div style="padding:24px">'+data.error+'</div>';return;}
    const fn=[data.prenom||'',data.nom||''].filter(Boolean).join(' ').trim()||'Contact';
    document.getElementById('fn').textContent=fn;
    document.getElementById('subtitle').textContent=data.poste||'';

    if(data.telephone){
      const tel=data.telephone;
      document.getElementById('telLink').textContent=tel;
      document.getElementById('telLink').href=`tel:${tel}`;
      document.getElementById('row-tel').style.display='';
      const wa=tel.replace(/[^\d]/g,'');
      document.getElementById('waLink').textContent='WhatsApp';
      document.getElementById('waLink').href=`https://wa.me/${wa}`;
      document.getElementById('row-wa').style.display='';
    }
    if(data.email){
      const m=document.getElementById('mailLink');
      m.textContent=data.email;
      m.href=`mailto:${data.email}`;
      document.getElementById('row-mail').style.display='';
    }

    // --- Site et prévisualisation ---
    const site=data.hotelSite || 'https://www.flowcode.com/page/pullmanabidjan0?preview=true';
    const a1=document.getElementById('siteLink2');
    const btnFallback=document.getElementById('btnSiteFallback');
    a1.href=site; a1.textContent=site;
    btnFallback.href=site;

    const frame=document.getElementById('siteFrame');
    const wrap=document.getElementById('frameWrap');
    const skeleton=document.getElementById('skeleton');
    const fallback=document.getElementById('fallback');

    // 1) Essaye d'embarquer le site
    frame.src=site;

    let loaded=false;
    frame.addEventListener('load', ()=>{ loaded=true; wrap.classList.add('loaded'); skeleton.style.display='none'; });

    // 2) Si au bout de 2.5s rien n'a chargé -> fallback visuel
    setTimeout(()=>{
      if(!loaded){
        wrap.style.display='none';
        fallback.style.display='';
      }
    }, 2500);

    // vCard locale
    document.getElementById('btnVcf').addEventListener('click',ev=>{
      ev.preventDefault();
      const lines=['BEGIN:VCARD','VERSION:3.0',`N:${data.nom||''};${data.prenom||''};;;`,`FN:${fn}`];
      if(data.poste)lines.push('TITLE:'+data.poste);
      if(data.telephone)lines.push('TEL;TYPE=CELL,VOICE:'+data.telephone);
      if(data.email)lines.push('EMAIL;TYPE=INTERNET:'+data.email);
      if(site)lines.push('URL:'+site);
      lines.push('END:VCARD');
      const blob=new Blob([lines.join('\r\n')],{type:'text/vcard;charset=utf-8'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download=(fn||'contact')+'.vcf';
      a.click(); setTimeout(()=>URL.revokeObjectURL(url),1e3);
    });
  };

  const s=document.createElement('script'); s.src=API; document.body.appendChild(s);
})();
</script>
</body>
</html>
